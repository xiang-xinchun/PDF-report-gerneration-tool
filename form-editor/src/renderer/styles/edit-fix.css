/* 
 * 修复编辑功能的样式文件
 * 此文件添加了确保所有可编辑元素在正常模式下可以编辑的样式
 */

/* 确保可编辑元素在正常模式下可以编辑 */
[contenteditable="true"] {
    cursor: text !important;
    pointer-events: auto !important;
    user-select: text !important;
    -webkit-user-select: text !important;
    -webkit-user-modify: read-write !important; /* Chromium特有属性，关键！ */
    background-color: rgba(255, 255, 255, 0.7) !important;
    border: 1px dashed #ccc !important;
    min-height: 24px; /* 基础高度保障 */
    display: block; /* 默认块级，防止内联元素塌缩 */
    /* 强制某些浏览器进行层提升，解决渲染卡顿或不更新问题 */
    transform: translateZ(0);
    will-change: contents;
}

/* 针对特定类别的内联覆盖 */
span[contenteditable="true"], 
.editable-text {
    display: inline-block !important; /* 内联块级，允许设置宽高 */
}

[contenteditable="true"]:focus {
    outline: none !important;
    border-color: #2196F3 !important;
    background-color: #fff !important;
    box-shadow: 0 0 3px rgba(33, 150, 243, 0.3) !important;
}

/* 确保空的可编辑元素有最小尺寸和正确的显示模式 
   注意：这非常关键，当内容被清空时，它是唯一支撑元素尺寸的规则
*/
[contenteditable="true"]:empty {
    display: inline-block !important;
    min-height: 24px !important;
    min-width: 20px !important; /* 确保至少有一个光标的宽度 */
    height: auto !important;
    vertical-align: middle;
}

/* 确保输入框在正常模式下可以编辑 */
input.input-field, 
textarea.input-field, 
select.input-field {
    cursor: text !important;
    pointer-events: auto !important;
    user-select: text !important;
    -webkit-user-select: text !important;
    background-color: white !important;
    border: 1px solid #ddd !important;
}

/* 全局强制所有交互元素可用 - 防止confirm/alert后失效 */
input:not([type="hidden"]):not([disabled]),
textarea:not([disabled]),
select:not([disabled]),
[contenteditable="true"],
button:not([disabled]) {
    pointer-events: auto !important;
    user-select: text !important;
    -webkit-user-select: text !important;
}

/* 对contenteditable元素特别加强 - Chromium内核必需 */
[contenteditable="true"] {
    -webkit-user-modify: read-write !important;
}

/* 确保body没有全局阻止 */
body {
    pointer-events: auto !important;
}

/* 移除可能被添加的遮罩层 */
.modal-backdrop,
.overlay {
    display: none !important;
    opacity: 0 !important;
    pointer-events: none !important;
}


input.input-field:focus, 
textarea.input-field:focus, 
select.input-field:focus {
    outline: none !important;
    border-color: #2196F3 !important;
    box-shadow: 0 0 3px rgba(33, 150, 243, 0.3) !important;
}

/* 确保表格中的可编辑内容可以正常编辑 */
td [contenteditable="true"], 
td .input-field {
    cursor: text !important;
    pointer-events: auto !important;
    user-select: text !important;
    -webkit-user-select: text !important;
}

/* 仅在导出模式下应用特殊样式 */
body.is-exporting-pdf [contenteditable="true"],
body.is-exporting-pdf input.input-field,
body.is-exporting-pdf textarea.input-field,
body.is-exporting-pdf select.input-field {
    border: none !important;
    box-shadow: none !important;
}

/* 编辑项容器样式 */
.editable-item-container {
    position: relative;
    display: inline-flex;
    align-items: center;
    margin-right: 5px;
}

/* 删除按钮样式 - 已隐藏 */
.delete-button, .row-delete-button {
    display: none; /* 始终隐藏所有删除按钮 */
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    background-color: #f44336;
    color: white;
    border-radius: 50%;
    font-size: 12px;
    cursor: pointer;
    margin-left: 5px;
    border: none;
    outline: none;
    transition: background-color 0.3s;
}

.row-delete-button {
    margin: 0 auto;
}

.delete-button:hover {
    background-color: #d32f2f;
}

/* 打印时隐藏删除按钮和操作按钮 */
@media print {
    .delete-button,
    .undo-button,
    .reset-button,
    .edit-controls,
    .toast-container {
        display: none !important;
    }
}

/* 导出PDF时隐藏删除按钮和操作按钮 */
body.is-exporting-pdf .delete-button,
body.is-exporting .delete-button,
body.is-exporting-pdf .undo-button,
body.is-exporting .undo-button,
body.is-exporting-pdf .reset-button,
body.is-exporting .reset-button,
body.is-exporting-pdf .edit-controls,
body.is-exporting .edit-controls,
body.is-exporting-pdf .toast-container,
body.is-exporting .toast-container {
    display: none !important;
}

/* 表格行删除按钮样式 */
.row-delete-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    background-color: #f44336;
    color: white;
    border-radius: 50%;
    font-size: 14px;
    cursor: pointer;
    border: none;
    outline: none;
    transition: background-color 0.3s;
    margin: 0 auto;
}

.row-delete-button:hover {
    background-color: #d32f2f;
}

/* 打印时隐藏表格行删除按钮 */
@media print {
    .row-delete-button {
        display: none !important;
    }
}

/* 导出PDF时隐藏表格行删除按钮 */
body.is-exporting-pdf .row-delete-button,
body.is-exporting .row-delete-button {
    display: none !important;
}

/* 表格行删除按钮单元格样式 */
.delete-cell {
    width: 30px;
    text-align: center;
    vertical-align: middle;
}

/* 强制修复：确保所有输入元素始终可交互 */
input, 
textarea, 
select, 
[contenteditable],
[contenteditable="true"] {
    pointer-events: auto !important;
    user-select: text !important;
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
}

/* 防止弹窗后输入框失效 */
body input,
body textarea,
body select,
body [contenteditable],
body [contenteditable="true"] {
    pointer-events: auto !important;
    user-select: text !important;
}

/* 最高优先级：确保焦点元素可交互 */
*:focus,
input:focus,
textarea:focus,
select:focus,
[contenteditable]:focus,
[contenteditable="true"]:focus {
    pointer-events: auto !important;
    user-select: text !important;
}